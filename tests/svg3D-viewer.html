<!DOCTYPE html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<style>
.svg3d-shadow{
}
</style>
</head>
<body style="background: radial-gradient(circle farthest-side at center,#FFF 0,#dae4e4 100%);">
    <svg version="1.1" id="svg3d-mainviewer" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="800px" height="800px" viewBox="0 0 7000 7000" enable-="new 0 0 1256 1256" xml:space="preserve" onmousemove="rotate()" style="margin: 100px auto; display: block;background: radial-gradient(circle farthest-side at center,#FFF 0,#dae4e4 100%);"> 
<pattern  x="0.5" y="1256.5" width="100" height="100" patternUnits="userSpaceOnUse" id="pattern-stripe" viewBox="0 -100 100 100" overflow="visible">
    <g>
        <polygon fill="none" points="0,0 100,0 100,-100 0,-100      "/>
        <polygon fill="#36A9E1" points="0,0 20,0 20,-100 0,-100         "/>
    </g>
</pattern>
<g id="Layer_1">
    <g>
        <rect x="50" y="53" fill="#3F9BC4" width="6901.798" height="6901.798"/>
        <path fill="#FFFFFF" d="M6901.799,103v6801.798H100V103H6901.799 M7001.799,3H0v7001.798h7001.798V3L7001.799,3z"/>
    </g>
    <g>
        
            <pattern  id="SVGID_1_" xlink:href="#pattern-stripe" patternTransform="matrix(0.7071 0.7071 0.7071 -0.7071 290.3901 1136.6304)">
        </pattern>
        <rect x="50" y="53" fill="url(#SVGID_1_)" width="6901.798" height="6901.798"/>
        <path fill="#FFFFFF" d="M6901.799,103v6801.798H100V103H6901.799 M7001.799,3H0v7001.798h7001.798V3L7001.799,3z"/>
    </g>
</g>
<g id="Layer_2">
    <path fill="#C8C9B2" d="M1239.136,556.382c167.257-150.533,284.339-367.967,602.126-317.79
        c317.787,50.178,652.303,234.159,685.754,602.126c33.45,367.967,66.901,836.286,384.691,836.286
        c317.789,0,267.608-351.24,802.832-301.063c535.225,50.178,585.406,50.182,618.855,367.968
        c33.447,317.786-451.599,735.931-501.775,869.737c-50.178,133.806-133.81,936.637-117.08,1154.07
        c16.729,217.435-234.16,735.935-1120.622,351.243s-886.462-1070.444-853.011-1421.685s-551.947-1087.172-869.737-1170.801
        c-317.789-83.629-468.322-434.869-401.417-618.852C536.656,723.639,1071.879,706.915,1239.136,556.382z"/>
    <path fill="#5C855C" d="M1395.121,849.394c119.973-107.979,201.464-446.083,429.414-410.09
        c227.952,35.993,470.396,350.103,494.391,614.044c23.994,263.949,281.736,741.779,509.152,757.463
        c485.046,33.451,460.447-350.971,844.368-314.978c383.918,35.993,436.251,20.126,460.237,248.076
        c23.998,227.949-503.915,705.224-535.224,802.833c-96.561,301.062-79.396,923.034-149.743,1062.75
        c-140.148,278.342-234.659,534.526-870.523,258.58c-635.862-275.936-676.298-1169.738-652.304-1421.686
        c23.995-251.946-565.762-841.15-793.714-901.139c-227.952-59.99-335.932-311.934-287.939-443.905
        C891.225,969.369,1275.146,957.37,1395.121,849.394z"/>
    <path fill="#C8C9B2" d="M6901.771,6391.517c-653.647,153.233-1110.717-102.228-1471.198-258.487
        c-510.933-221.479-1836.177,37.542-2084.419,344.133c-248.247,306.603-830.671,288.071-1079.111,117.586
        c-248.443-170.479-65.402-769.66-224.95-1033.26c-159.548-263.604-438.386-507.013-240.043-831.188
        c198.337-324.17,602.771-596.49,1164.659-440.029c561.881,156.473,1273.447,365.67,1396.939,15.129
        c123.492-350.546-419.936-479.776-137.104-1043.799c282.845-564.023,302.346-619.378,789.379-489.276
        c487.021,130.102,922.267,884.877,1102.355,1010.542c99.658,69.536,388.959,209.191,783.568,379.933"/>
    <path fill="#5C855C" d="M6901.848,6079.003c-650.882,211.762-1407.53-121.897-1774.027-280.765
        c-366.486-158.868-1474.552,182.059-1652.632,401.981c-178.068,219.922-595.837,206.639-774.048,84.344
        c-178.207-122.283-46.916-552.084-161.357-741.16c-114.444-189.088-587.113-456.65-444.845-689.187
        c142.273-232.53,705.03-334.895,1108.065-222.666c403.043,112.229,1215.977,79.021,1327.737-163.593
        c238.389-517.465-344.596-692.35-141.708-1096.916c202.877-404.584,199.535-470.647,548.883-377.326
        c349.359,93.327,856.139,926.465,989.561,1012.284c411.574,264.727,793.303,305.567,974.371,456.585"/>
</g>
        <filter id="blur">
          <feGaussianBlur in="SourceAlpha" stdDeviation="10" />
        </filter>
        
        
        <g id="house" class="svg3d-object" svg3d-position="500,500,0" svg3d-color="rgb(255,255,51)" svg3d-rotate="0,0,0">
            <linearGradient id="gradient5" class="gradient5" gradientUnits="userSpaceOnUse" x1="502.0151" y1="1047.3691" x2="900.4153" y2="1047.8059" >
                <stop class="color5" offset="0%" style="stop-color:rgb(255,255,255)"/>
                <stop class="color5" offset="100%" style="stop-color:rgb(255,255,255)"/>
            </linearGradient>
            <g class="svg3d-shadow" filter="url(#blur)" style="opacity:0.5;">
            </g>
            <path id="front" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,-1,0" svg3d-data="M 188,-125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,-125,107 L -177,-125,107 L -177,-125,7 L 158,-125,-1 L 158,-125,99 L 158,-125,99 Z" fill="rgb(0,100,0)" d="" />
            <path id="back" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,1,0" svg3d-data="M 188,125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,125,107 L -177,125,107 L -177,125,-7 L 158,125,-1 L 158,125,99 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="left" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-1,0,0" svg3d-data="M -177,-125,107 L -177,-125,7 L -177,125,7 L -177,125,107 Z" fill="rgb(0,0,100)" d="" />
            <path id="right" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="1,0,0" svg3d-data="M 158,-125,99 L 158,-125,-1 L 158,125,-1 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="topright" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7" svg3d-data="M 188,-125,100 L 25,-125,176 L 25,125,176 L 188,125,100 Z" fill="rgb(100,10,10)" d=""  />
            <path id="topnock" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7,-0.7,0,0.7" fill="url(#gradient5)" svg3d-data="M 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -26,125,177 C -10,125,182 11,125,181 25,125,176 Z"  d=""  />
            <path id="topleft" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-0.7,0,0.7" svg3d-data="M -26,-125,177 L -207,-125,107 L -207,125,107 L -26,125,177 L -26,-125,177 Z" fill="rgb(100,0,30)" d=""  />
        </g>

        <g id="house2" class="svg3d-object" svg3d-position="1500,1500,0" svg3d-color="rgb(102,204,102)" svg3d-rotate="0,0,0">
            <linearGradient id="gradient5" class="gradient5" gradientUnits="userSpaceOnUse" x1="502.0151" y1="1047.3691" x2="900.4153" y2="1047.8059" >
                <stop class="color5" offset="0%" style="stop-color:rgb(255,255,255)"/>
                <stop class="color5" offset="100%" style="stop-color:rgb(255,255,255)"/>
            </linearGradient>
            <g class="svg3d-shadow" filter="url(#blur)" style="opacity:0.5;">
            </g>
            <path id="front" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,-1,0" svg3d-data="M 188,-125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,-125,107 L -177,-125,107 L -177,-125,7 L 158,-125,-1 L 158,-125,99 L 158,-125,99 Z" fill="rgb(0,100,0)" d="" />
            <path id="back" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,1,0" svg3d-data="M 188,125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,125,107 L -177,125,107 L -177,125,-7 L 158,125,-1 L 158,125,99 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="left" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-1,0,0" svg3d-data="M -177,-125,107 L -177,-125,7 L -177,125,7 L -177,125,107 Z" fill="rgb(0,0,100)" d="" />
            <path id="right" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="1,0,0" svg3d-data="M 158,-125,99 L 158,-125,-1 L 158,125,-1 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="topright" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7" svg3d-data="M 188,-125,100 L 25,-125,176 L 25,125,176 L 188,125,100 Z" fill="rgb(100,10,10)" d=""  />
            <path id="topnock" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7,-0.7,0,0.7" fill="url(#gradient5)" svg3d-data="M 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -26,125,177 C -10,125,182 11,125,181 25,125,176 Z"  d=""  />
            <path id="topleft" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-0.7,0,0.7" svg3d-data="M -26,-125,177 L -207,-125,107 L -207,125,107 L -26,125,177 L -26,-125,177 Z" fill="rgb(100,0,30)" d=""  />
        </g>

        <g id="house3" class="svg3d-object" svg3d-position="1500,700,0" svg3d-color="rgb(204,102,102)" svg3d-rotate="0,0,0">
            <linearGradient id="gradient5" class="gradient5" gradientUnits="userSpaceOnUse" x1="502.0151" y1="1047.3691" x2="900.4153" y2="1047.8059" >
                <stop class="color5" offset="0%" style="stop-color:rgb(255,255,255)"/>
                <stop class="color5" offset="100%" style="stop-color:rgb(255,255,255)"/>
            </linearGradient>
            <g class="svg3d-shadow" filter="url(#blur)" style="opacity:0.5;">
            </g>
            <path id="front" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,-1,0" svg3d-data="M 188,-125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,-125,107 L -177,-125,107 L -177,-125,7 L 158,-125,-1 L 158,-125,99 L 158,-125,99 Z" fill="rgb(0,100,0)" d="" />
            <path id="back" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,1,0" svg3d-data="M 188,125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,125,107 L -177,125,107 L -177,125,-7 L 158,125,-1 L 158,125,99 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="left" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-1,0,0" svg3d-data="M -177,-125,107 L -177,-125,7 L -177,125,7 L -177,125,107 Z" fill="rgb(0,0,100)" d="" />
            <path id="right" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="1,0,0" svg3d-data="M 158,-125,99 L 158,-125,-1 L 158,125,-1 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="topright" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7" svg3d-data="M 188,-125,100 L 25,-125,176 L 25,125,176 L 188,125,100 Z" fill="rgb(100,10,10)" d=""  />
            <path id="topnock" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7,-0.7,0,0.7" fill="url(#gradient5)" svg3d-data="M 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -26,125,177 C -10,125,182 11,125,181 25,125,176 Z"  d=""  />
            <path id="topleft" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-0.7,0,0.7" svg3d-data="M -26,-125,177 L -207,-125,107 L -207,125,107 L -26,125,177 L -26,-125,177 Z" fill="rgb(100,0,30)" d=""  />
        </g>

        <g id="house3" class="svg3d-object" svg3d-position="2500,2700,0" svg3d-color="rgb(102,102,204)" svg3d-rotate="0,0,0">
            <linearGradient id="gradient5" class="gradient5" gradientUnits="userSpaceOnUse" x1="502.0151" y1="1047.3691" x2="900.4153" y2="1047.8059" >
                <stop class="color5" offset="0%" style="stop-color:rgb(255,255,255)"/>
                <stop class="color5" offset="100%" style="stop-color:rgb(255,255,255)"/>
            </linearGradient>
            <g class="svg3d-shadow" filter="url(#blur)" style="opacity:0.5;">
            </g>
            <path id="front" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,-1,0" svg3d-data="M 188,-125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,-125,107 L -177,-125,107 L -177,-125,7 L 158,-125,-1 L 158,-125,99 L 158,-125,99 Z" fill="rgb(0,100,0)" d="" />
            <path id="back" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0,1,0" svg3d-data="M 188,125,100 L 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -207,125,107 L -177,125,107 L -177,125,-7 L 158,125,-1 L 158,125,99 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="left" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-1,0,0" svg3d-data="M -177,-125,107 L -177,-125,7 L -177,125,7 L -177,125,107 Z" fill="rgb(0,0,100)" d="" />
            <path id="right" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="1,0,0" svg3d-data="M 158,-125,99 L 158,-125,-1 L 158,125,-1 L 158,125,99 Z" fill="rgb(0,0,100)" d="" />

            <path id="topright" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7" svg3d-data="M 188,-125,100 L 25,-125,176 L 25,125,176 L 188,125,100 Z" fill="rgb(100,10,10)" d=""  />
            <path id="topnock" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="0.7,0,0.7,-0.7,0,0.7" fill="url(#gradient5)" svg3d-data="M 25,-125,176 C 11,-125,181 -10,-125,182 -26,-125,177 L -26,125,177 C -10,125,182 11,125,181 25,125,176 Z"  d=""  />
            <path id="topleft" class="svg3d-path" stroke-miterlimit="10" svg3d-angle="-0.7,0,0.7" svg3d-data="M -26,-125,177 L -207,-125,107 L -207,125,107 L -26,125,177 L -26,-125,177 Z" fill="rgb(100,0,30)" d=""  />
        </g>
    </svg>
    <button onclick="rotateToggle()">rotate</button>
</body>
<script type="text/javascript">
//M 483,117 l -163,-76 c 0,0 -14,-5 -25,-6 c -10,0 -26,5 -26,5 l -181,70 l 30,0 l 0,100 l 335,8 l 0,-100 l 30,0 z
var down = false;
var mouse_position =[0,0]
$(document).mousedown(function() {
    down = true;
    mouse_position = [ event.clientX, event.clientY];
    console.log('down');
}).mouseup(function() {
    down = false;  
    console.log('up');
});

function arrParseFloat(e,i,a){a[i] = parseFloat(e);}
rotateswitch=false;
function rotateToggle(){rotateswitch=!rotateswitch;}

var mainviewer = document.getElementById('svg3d-mainviewer');

function rotate(){
    if(down){
        var viewBox = mainviewer.getAttribute('viewBox').split(' '); viewBox.forEach(arrParseFloat);
        var dimentions = [ viewBox[2]-viewBox[0], viewBox[3]-viewBox[1]];
        if(!rotateswitch){
            var width=parseInt(mainviewer.getAttribute('width'));
            var height=parseInt(mainviewer.getAttribute('height'));
            viewBox=[ (mouse_position[0]-event.clientX)/2*(dimentions[0]/width),
                      (mouse_position[1]-event.clientY)/2*(dimentions[1]/height), 
                      (mouse_position[0]-event.clientX)/2*(dimentions[0]/width)+dimentions[0],
                      (mouse_position[1]-event.clientY)/2*(dimentions[1]/height)+dimentions[0] ];
            mainviewer.setAttribute('viewBox', viewBox.join(' '))
        }
        var camera = [(viewBox[0]+(dimentions[0]/2)),(viewBox[1]+(dimentions[1]/2)), 4000];
        var light = [(viewBox[0]+(dimentions[0]*0.1)),(viewBox[1]+(dimentions[1]*0.1)), 5000];
        
        //Calculate vector of the mouse move.
        var mouse_drag = [ (-mouse_position[1]+event.clientY)/200,(mouse_position[0] - event.clientX)/200, 0];
        //Grap all Objects
        var object_elements = mainviewer.getElementsByClassName('svg3d-object');
        var o = object_elements.length;
        while(o--){
            var object = object_elements[o];
            var rotate = object.getAttribute('svg3d-rotate').split(','); rotate.forEach(arrParseFloat);
            var position = object.getAttribute('svg3d-position').split(','); position.forEach(arrParseFloat);
            var color = object.getAttribute('svg3d-color').substr(4,object.getAttribute('svg3d-color').length-5).split(','); color.forEach(arrParseFloat);
            var shadow_innerHTML='';
            //Grab all <paths> inside Object
            var path_elements = object.getElementsByClassName('svg3d-path');
            var shadow_element = object.getElementsByClassName('svg3d-shadow')[0];

            var tocamera = [camera[0]-position[0],camera[1]-position[1],camera[2]-position[2]];
            var tolight = [light[0]-position[0],light[1]-position[1],light[2]-position[2]];

            p = path_elements.length;
            while(p--){
                var path = path_elements[p];
                var d = '';
                var path_points2D = [];
                var shadow_points2D = [];
                var vectors_for_gradient=[];
                var avector = path.getAttribute('svg3d-angle').split(','); avector.forEach(arrParseFloat);
                var cylinder=false;
                if(avector.length==6){cylinder=true;}
                if(tocamera[0]>0 && avector[0]<-0.9 || tocamera[1]>0 && avector[1]<-0.9 || tocamera[0]<0 && avector[0]>0.9 || tocamera[1]<0 && avector[1]>0.9 ){
                }else{
                    var angle = Math.acos((tolight[0]*avector[0]+tolight[1]*avector[1]+tolight[2]*avector[2])/( Math.sqrt((Math.pow(tolight[0],2)+Math.pow(tolight[1],2)+Math.pow(tolight[2],2))) * Math.sqrt((Math.pow(avector[0],2)+Math.pow(avector[1],2)+Math.pow(avector[2],2))) ));
                    var shadefactor = ((Math.PI)-angle)/(Math.PI);
                    var path_color = [ Math.round(color[0]*shadefactor), Math.round(color[1]*shadefactor), Math.round(color[2]*shadefactor) ];
                    if(cylinder){
                        var angle2 = Math.acos((tolight[0]*avector[3]+tolight[1]*avector[4]+tolight[2]*avector[5])/( Math.sqrt((Math.pow(tolight[0],2)+Math.pow(tolight[1],2)+Math.pow(tolight[2],2))) * Math.sqrt((Math.pow(avector[3],2)+Math.pow(avector[4],2)+Math.pow(avector[5],2))) ));
                        var shadefactor2 = ((Math.PI)-angle2)/(Math.PI);
                        var path_color2 = [ Math.round(color[0]*shadefactor2), Math.round(color[1]*shadefactor2), Math.round(color[2]*shadefactor2) ];
                        c = object.getElementsByClassName("color"+p);
                        c[0].setAttribute('style', 'stop-color:rgb('+path_color.join(',')+')');
                        c[1].setAttribute('style', 'stop-color:rgb('+path_color2.join(',')+')');
                    }else{
                        path.setAttribute('fill', 'rgb('+path_color.join(',')+')');
                    }
                    var path_points3D = path.getAttribute('svg3d-data').split(' ');
                    
                    var i = 0;
                    while(i < path_points3D.length){
                        if(path_points3D[i].length!=1){
                            var point = path_points3D[i].split(','); point.forEach(arrParseFloat);
                            if(rotateswitch){
                                //Rotation algoritm:
                                var cosM0 = Math.cos(mouse_drag[0]);
                                var sinM0 = Math.sin(mouse_drag[0]); 
                                var cosM1 = Math.cos(mouse_drag[1]);  
                                var sinM1 = Math.sin(mouse_drag[1]);
                                          //Drag x-axis
                                point = [ point[0], 
                                          (point[2]*sinM0)+(point[1]*cosM0), 
                                          (point[2]*cosM0)-(point[1]*sinM0) ];
                                          //Drag y-axis
                                point = [ (point[0]*cosM1)-(point[2]*sinM1), 
                                          point[1], 
                                          (point[0]*sinM1)+(point[2]*cosM1)];
                            }
                            //Projection:
                            var projpoint = [ camera[0]-(camera[2]*(camera[0]-position[0]-point[0])/(camera[2]-position[2]-point[2])),
                                              camera[1]-(camera[2]*(camera[1]-position[1]-point[1])/(camera[2]-position[2]-point[2])) ];
                            path_points2D.push(projpoint.join(','));
                            //Shadow: relative to light.
                            var shadowpoint = [ light[0]-(light[2]*(light[0]-position[0]-point[0])/(light[2]-position[2]-point[2])),
                                              light[1]-(light[2]*(light[1]-position[1]-point[1])/(light[2]-position[2]-point[2])) ];
                            shadow_points2D.push(shadowpoint.join(','));
                            i++;
                        } else {
                            if(projpoint){vectors_for_gradient.push(projpoint);}
                            path_points2D.push(path_points3D[i]);
                            shadow_points2D.push(path_points3D[i]);
                            i++;
                        }
                        
                    }
                }
                d = path_points2D.join(' ');
                path.setAttribute('d', d);
                d = shadow_points2D.join(' ');
                shadow_innerHTML += '<path class="svg3d-shadow" stroke-miterlimit="10" d="'+d+'" />';

                if(cylinder){
                    g = object.getElementsByClassName("gradient"+p)[0];
                    g.setAttribute('x2',vectors_for_gradient[0][0]);
                    g.setAttribute('y2',vectors_for_gradient[0][1]);
                    g1=vectors_for_gradient[0]; o2=vectors_for_gradient[1]; g3=vectors_for_gradient[2];
                    g1[0]=g1[0]-o2[0]; g1[1]=g1[1]-o2[1]; 
                    g3[0]=g3[0]-o2[0]; g3[1]=g3[1]-o2[1]; 
                    var dot1 = [ ((-g1[0])*g3[0])+((-g1[1])*g3[1])/((Math.pow(g1[0]/g1[1],2)+1)*(Math.pow(g3[0]/g3[1],2)+1)), ];
                    dot1[1] = dot1[0]*g3[1]/g3[0];
                    g.setAttribute('x1',o2[0]); //dot1[0]+
                    g.setAttribute('y1',o2[1]); //dot1[1]+
                }
                
                //var dot1= ((-g1[0])*g3[0])+((-g1[1])*g3[1])/((Math.pow(g1[0],2)+Math.pow(g1[1],2))*(Math.pow(g3[0],2)+Math.pow(g3[1],2)))
                rotate =[rotate[0]+mouse_drag[0], rotate[1]+mouse_drag[1], rotate[2]];
                path.setAttribute('svg3d-rotate', mouse_drag.join());
            }
            shadow_element.innerHTML = shadow_innerHTML;
        }
    }
}


/*
<body style=": radial-gradient(circle farthest-side at center,#FFF 0,#dae4e4 100%);">
    <svg version="1.1" id="svg3d-mainviewer" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="500" height="500" viewBox="0 0 2000 2000" enable-="new 0 0 1256 1256" xml:space="preserve" onmousemove="rotate()" style="border-style:solid;margin: 100px auto; display: block;"> 
    <g id="house" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0">
        <g>
            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,-125,0 L 25,-125,76 C 25,-125,76 11,-125,81 0,-125,82 C -10,-125,82 -26,-125,77 -26,-125,77 L -207,-125,7 L -177,-125,7 L -177,-125,-93 L 158,-125,-101 L 158,-125,-1 L 158,-125,-1 Z" fill="rgb(0,100,0)" d="" />
            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,125,0 L 25,125,76 C 25,125,76 11,125,81 0,125,82 C -10,125,82 -26,125,77 -26,125,77 L -207,125,7 L -177,125,7 L -177,125,-93 L 158,125,-101 L 158,125,-1 L 158,125,-1 Z" fill="rgb(0,0,100)" d="" />

            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M -177,-125,7 L -177,-125,-93 L -177,125,-93 L -177,125,7 Z" fill="rgb(0,0,100)" d="" />
            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 158,-125,-1 L 158,-125,-101 L 158,125,-101 L 158,125,-1 Z" fill="rgb(0,0,100)" d="" />

            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,-125,0 L 25,-125,76 L 25,125,76 L 188,125,0 Z" fill="rgb(100,10,10)" d=""  />
            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 25,-125,76 C 25,-125,76 11,-125,81 0,-125,82 C -10,-125,82 -26,-125,77 -26,-125,77 L -26,125,77 C 0,125,82 -16,125,77 0,125,82 C 14,125,77 0,125,82 25,125,77 Z" fill="rgb(100,30,0)" d=""  />
            <path class="svg3d-shadow" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M -26,-125,77 L -207,-125,7 L -207,125,7 L -26,125,77 L -26,-125,77 Z" fill="rgb(100,0,30)" d=""  />
        </g>
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,-125,0 L 25,-125,76 C 25,-125,76 11,-125,81 0,-125,82 C -10,-125,82 -26,-125,77 -26,-125,77 L -207,-125,7 L -177,-125,7 L -177,-125,-93 L 158,-125,-101 L 158,-125,-1 L 158,-125,-1 Z" fill="rgb(0,100,0)" d="" />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,125,0 L 25,125,76 C 25,125,76 11,125,81 0,125,82 C -10,125,82 -26,125,77 -26,125,77 L -207,125,7 L -177,125,7 L -177,125,-93 L 158,125,-101 L 158,125,-1 L 158,125,-1 Z" fill="rgb(0,0,100)" d="" />

        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M -177,-125,7 L -177,-125,-93 L -177,125,-93 L -177,125,7 Z" fill="rgb(0,0,100)" d="" />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 158,-125,-1 L 158,-125,-101 L 158,125,-101 L 158,125,-1 Z" fill="rgb(0,0,100)" d="" />

        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,-125,0 L 25,-125,76 L 25,125,76 L 188,125,0 Z" fill="rgb(100,10,10)" d=""  />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 25,-125,76 C 25,-125,76 11,-125,81 0,-125,82 C -10,-125,82 -26,-125,77 -26,-125,77 L -26,125,77 C 0,125,82 -16,125,77 0,125,82 C 14,125,77 0,125,82 25,125,77 Z" fill="rgb(100,30,0)" d=""  />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M -26,-125,77 L -207,-125,7 L -207,125,7 L -26,125,77 L -26,-125,77 Z" fill="rgb(100,0,30)" d=""  />

    </g>
</svg>
</body>
<script type="text/javascript">
//M 483,117 l -163,-76 c 0,0 -14,-5 -25,-6 c -10,0 -26,5 -26,5 l -181,70 l 30,0 l 0,100 l 335,8 l 0,-100 l 30,0 z
var down = false;
var mouse_position =[0,0]
$(document).mousedown(function() {
    down = true;
    mouse_position = [ event.clientX, event.clientY];
    console.log('down');
}).mouseup(function() {
    down = false;  
    console.log('up');
});

function arrParseFloat(e,i,a){a[i] = parseInt(e);}

var mainviewer = document.getElementById('svg3d-mainviewer');
var camera = [mainviewer.getAttribute('width')/2,mainviewer.getAttribute('height')/2,1000];

function rotate(){
    if(down){
        //Calculate vector of the mouse move.
        var mouse_drag = [ (-mouse_position[1]+event.clientY)/200,(mouse_position[0] - event.clientX)/200, 0];
        //console.log(mouse_drag);
        var path_elements = mainviewer.getElementsByClassName('svg3d-path');
        p = path_elements.length;
        while(p--){
            var path = path_elements[p];

            var rotate = path.getAttribute('svg3d-rotate').split(','); rotate.forEach(arrParseFloat);
            var position = path.getAttribute('svg3d-position').split(','); position.forEach(arrParseFloat);
            var color = path.getAttribute('svg3d-color').substr(4,path.getAttribute('svg3d-color').length-5).split(',');

            var path_points2D = [];
            var path_points3D = path.getAttribute('svg3d-data').split(' ');

            var d = '';
            var i = 0;
            while(i < path_points3D.length){
                //console.log('point: '+path_points3D[i]);

                if(path_points3D[i].length!=1){
                    var point = path_points3D[i].split(','); point.forEach(arrParseFloat);
                    //Rotation algoritm:
                    var cosM0 = Math.cos(mouse_drag[0]);
                    var sinM0 = Math.sin(mouse_drag[0]); 
                    var cosM1 = Math.cos(mouse_drag[1]);  
                    var sinM1 = Math.sin(mouse_drag[1]);
                              //Drag x-axis
                    point = [ point[0], 
                              (point[2]*sinM0)+(point[1]*cosM0), 
                              (point[2]*cosM0)-(point[1]*sinM0) ];
                              //Drag y-axis
                    point = [ (point[0]*cosM1)-(point[2]*sinM1), 
                              point[1], 
                              (point[0]*sinM1)+(point[2]*cosM1)];
                    //Projection: relative to camera.
                    var projpoint = [ ((camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2])+camera[0]), 
                                      ((camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2])+camera[1]) ];
                    path_points2D.push(projpoint.join(','));
                    i++;
                } else {
                    path_points2D.push(path_points3D[i]);
                    i++;
                }
                
            }
            d = path_points2D.join(' ');
            path.setAttribute('d', d);
            rotate =[rotate[0]+mouse_drag[0], rotate[1]+mouse_drag[1], rotate[2]];
            path.setAttribute('svg3d-rotate', mouse_drag.join());
        }

        //Set new position of mouse.
        //mouse_position = [event.clientX, event.clientY];
    }
}
*/





/*

<g id="house" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" style="display:none;">
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,0,-125 l -163,-76,0 c 0,0,0 -14,-5,0 -25,-6,0 c -10,0,0 -26,5,0 -26,5,0 l -181,70,0 l 30,0,0 l 0,100,0 l 335,8,0 l 0,-100,0 l 30,0,0 z" fill="rgb(0,100,0)" d="" />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,0,125 l -163,-76,0 c 0,0,0 -14,-5,0 -25,-6,0 c -10,0,0 -26,5,0 -26,5,0 l -181,70,0 l 30,0,0 l 0,100,0 l 335,8,0 l 0,-100,0 l 30,0,0 z" fill="rgb(0,0,100)" d="" />

        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M -177,-7,-125 l 0,100,0 l 0,0,250 l 0,-100,0 z" fill="rgb(0,0,100)" d="" />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(0,100,0)" svg3d-rotate="0,0,0" svg3d-data="M 158,1,-125 l 0,100,0 l 0,0,250 l 0,-100,0 z" fill="rgb(0,0,100)" d="" />

        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 188,0,-125 l -163,-76,0 l 0,0,250 l 163,76,0 z" fill="rgb(100,10,10)" d=""  />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M 25,-76,-125 c 0,0,0 -14,-5,0 -25,-6,0 c -10,0,0 -26,5,0 -26,5,0 l 0,0,250 c 26,-5,0 10,0,0 26,-5,0 c 14,5,0 0,0,0 25,6,0 z" fill="rgb(100,30,0)" d=""  />
        <path class="svg3d-path" stroke-miterlimit="10" svg3d-position="0,0,0" svg3d-color="rgb(100,0,0)" svg3d-rotate="0,0,0" svg3d-data="M -26,-77,-125 l -181,70,0 l 0,0,250 l 181,-70,0 z" fill="rgb(100,0,30)" d=""  />

    </g>

function rotate(){
    if(down){
        //Calculate vector of the mouse move.
        var mouse_drag = [ (mouse_position[1]-event.clientY)/200, (event.clientX-mouse_position[0])/200, 0];
        console.log(mouse_drag);
        var path_elements = mainviewer.getElementsByClassName('svg3d-path');
        p = path_elements.length;
        while(p--){
            var path = path_elements[p];
            var path_points2D = [];
            var path_points3D = path.getAttribute('svg3d-data').split(' ');
            var rotate = path.getAttribute('svg3d-rotate').split(','); rotate = [parseInt(rotate[0]), parseInt(rotate[1]), parseInt(rotate[2])];
            var position = path.getAttribute('svg3d-position').split(','); position = [parseInt(position[0]), parseInt(position[1]), parseInt(position[2])];
            var color = path.getAttribute('svg3d-color').substr(4,path.getAttribute('svg3d-color').length-5).split(',');
            var d = '';
            var i = 0;
            while(i < path_points3D.length){
                //console.log('point: '+path_points3D[i]);

                path_points2D.push(path_points3D[i]);
                if( path_points3D[i] == 'M' || path_points3D[i] == 'm' ){
                    i++;
                    var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                    point = [ point[0], (point[2]*Math.sin(mouse_drag[0]))+(point[1]*Math.cos(mouse_drag[0])), (point[2]*Math.cos(mouse_drag[0]))-(point[1]*Math.sin(mouse_drag[0])) ];
                    point = [ (point[0]*Math.cos(mouse_drag[1]))-(point[2]*Math.sin(mouse_drag[1])), point[1], (point[0]*Math.sin(mouse_drag[1]))+(point[2]*Math.cos(mouse_drag[1]))];
                    //point relative to camera, projected on viewer.
                    var projpoint = [ ((camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2])+camera[0]), 
                                      ((camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2])+camera[1]) ];
                    path_points2D.push(projpoint.join(','));
                }
                else if( path_points3D[i] == 'L' || path_points3D[i] == 'l' ){
                    i++;
                    var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                    point = [ point[0], (point[2]*Math.sin(mouse_drag[0]))+(point[1]*Math.cos(mouse_drag[0])), (point[2]*Math.cos(mouse_drag[0]))-(point[1]*Math.sin(mouse_drag[0])) ];
                    point = [ (point[0]*Math.cos(mouse_drag[1]))-(point[2]*Math.sin(mouse_drag[1])), point[1], (point[0]*Math.sin(mouse_drag[1]))+(point[2]*Math.cos(mouse_drag[1]))];
                    //point relative to camera, projected on viewer.
                    var projpoint = [ ((camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2])), 
                                      ((camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2])) ];
                    path_points2D.push(projpoint.join(','));
                }
                else if(path_points3D[i] == 'C' || path_points3D[i] == 'c' ){
                    for(s in [0,1,2]){
                        i++;
                        var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                    point = [ point[0], (point[2]*Math.sin(mouse_drag[0]))+(point[1]*Math.cos(mouse_drag[0])), (point[2]*Math.cos(mouse_drag[0]))-(point[1]*Math.sin(mouse_drag[0])) ];
                    point = [ (point[0]*Math.cos(mouse_drag[1]))-(point[2]*Math.sin(mouse_drag[1])), point[1], (point[0]*Math.sin(mouse_drag[1]))+(point[2]*Math.cos(mouse_drag[1]))];
                        //point relative to camera, projected on viewer.
                        var projpoint = [ ((camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2])), 
                                          ((camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2])) ];
                        path_points2D.push(projpoint.join(','));
                    }
                }
                else if(path_points3D[i] == 'Z' || path_points3D[i] == 'z' ){
                    break;
                }
                else {
                    console.log('Unknown syntax! Alowed letters: M, L, C, Z. Example: "M 123,32,0 l 12,-4,0 c -10,0,0 -26,5,0 -26,5,0 z". Error: '+path_points3D[i]);
                    break;
                }
                i++;
            }
            //console.log('Projection points calculated');
            //console.log(path_points2D);
            d = path_points2D.join(' ');
            //console.log(d);
            path.setAttribute('d', d);
            rotate =[rotate[0]+mouse_drag[0], rotate[1]+mouse_drag[1], rotate[2]];
            console.log(rotate);
            path.setAttribute('svg3d-rotate', mouse_drag.join());
        }

        //Set new position of mouse.
        //mouse_position = [event.clientX, event.clientY];
    }
}
*/


/*
function rotate(){
    if(down){
        //Calculate vector of the mouse move.
        console.log('Triggered');
        var mouse_drag = [mouse_position[0] - event.clientX, mouse_position[1] - event.clientY];

        var path_elements = mainviewer.getElementsByClassName('svg3d-path');
        for(p in path_elements){
            console.log('Path: '+p);
            var path = path_elements[p];
            var path_points2D = [];
            var path_points3D = path.getAttribute('svg3d-data').split(' ');
            var position = path.getAttribute('svg3d-position').split(','); position = [parseInt(position[0]), parseInt(position[1]), parseInt(position[2])];
            var color = path.getAttribute('svg3d-color').substr(4,path.getAttribute('svg3d-color').length-5).split(',');
            var d = '';
            var i = 0;
            while(i < path_points3D.length){
                console.log('point: '+path_points3D[i]);

                path_points2D.push(path_points3D[i]);
                if( path_points3D[i] == 'M' || path_points3D[i] == 'm' ){
                    i++;
                    var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                    //point relative to camera, projected on viewer.
                    var projpoint = [ (camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2])+camera[0], 
                                      (camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2])+camera[1] ];
                    path_points2D.push(projpoint.join(','));
                }
                else if( path_points3D[i] == 'L' || path_points3D[i] == 'l' ){
                    i++;
                    var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                    //point relative to camera, projected on viewer.
                    var projpoint = [ (camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2]), 
                                      (camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2]) ];
                    path_points2D.push(projpoint.join(','));
                }
                else if(path_points3D[i] == 'C' || path_points3D[i] == 'c' ){
                    for(s in [0,1,2]){
                        i++;
                        var point = path_points3D[i].split(','); point = [parseInt(point[0]), parseInt(point[1]), parseInt(point[2])];
                        //point relative to camera, projected on viewer.
                        var projpoint = [ (camera[2]*(position[0]+point[0]))/(camera[2]-position[2]-point[2]), 
                                          (camera[2]*(position[1]+point[1]))/(camera[2]-position[2]-point[2]) ];
                        path_points2D.push(projpoint.join(','));
                    }
                }
                else if(path_points3D[i] == 'Z' || path_points3D[i] == 'z' ){
                    break;
                }
                else {
                    console.log('Unknown syntax! Alowed letters: M, L, C, Z. Example: "M 123,32,0 l 12,-4,0 c -10,0,0 -26,5,0 -26,5,0 z". Error: '+path_points3D[i]);
                    break;
                }
                i++;
            }
            console.log('Projection points calculated');
            console.log(path_points2D);
            d = path_points2D.join(' ');
            console.log(d);
            path.setAttribute('d', d);
        }

        //Set new position of mouse.
        mouse_position = [event.clientX, event.clientY];
    }
}
*/
</script>
